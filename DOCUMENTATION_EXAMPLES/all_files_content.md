# Project File Contents

_Generated: 2025-07-22 02:16:03_

**Existing branches:** main  
**Current branch:** `main`  
**Commit:** `fc62e41`   
**Repo:** https://github.com/sdkng44/document_folder_structure  
**Status:** ✔️ synced 
## Index
- **DOCUMENTATION_EXAMPLES/**        - [all_files_content.md](#DOCUMENTATION_EXAMPLESall_files_contentmd) | [GitHub](https://github.com/sdkng44/document_folder_structure/blob/fc62e41/DOCUMENTATION_EXAMPLES/all_files_content.md)        - [all_files_content.pdf](#DOCUMENTATION_EXAMPLESall_files_contentpdf) | [GitHub](https://github.com/sdkng44/document_folder_structure/blob/fc62e41/DOCUMENTATION_EXAMPLES/all_files_content.pdf)        - [all_files_content.png](#DOCUMENTATION_EXAMPLESall_files_contentpng) | [GitHub](https://github.com/sdkng44/document_folder_structure/blob/fc62e41/DOCUMENTATION_EXAMPLES/all_files_content.png)        - [directory_tree.md](#DOCUMENTATION_EXAMPLESdirectory_treemd) | [GitHub](https://github.com/sdkng44/document_folder_structure/blob/fc62e41/DOCUMENTATION_EXAMPLES/directory_tree.md)        - [directory_tree.pdf](#DOCUMENTATION_EXAMPLESdirectory_treepdf) | [GitHub](https://github.com/sdkng44/document_folder_structure/blob/fc62e41/DOCUMENTATION_EXAMPLES/directory_tree.pdf)        - [directory_tree.png](#DOCUMENTATION_EXAMPLESdirectory_treepng) | [GitHub](https://github.com/sdkng44/document_folder_structure/blob/fc62e41/DOCUMENTATION_EXAMPLES/directory_tree.png)- **docs/**        - [document_folder_structure.html](#docsdocument_folder_structurehtml) | [GitHub](https://github.com/sdkng44/document_folder_structure/blob/fc62e41/docs/document_folder_structure.html)        - [index.html](#docsindexhtml) | [GitHub](https://github.com/sdkng44/document_folder_structure/blob/fc62e41/docs/index.html)        - [search.js](#docssearchjs) | [GitHub](https://github.com/sdkng44/document_folder_structure/blob/fc62e41/docs/search.js)    - [LICENSE](#LICENSE) | [GitHub](https://github.com/sdkng44/document_folder_structure/blob/fc62e41/LICENSE)    - [README.md](#READMEmd) | [GitHub](https://github.com/sdkng44/document_folder_structure/blob/fc62e41/README.md)    - [config.json](#configjson) | [GitHub](https://github.com/sdkng44/document_folder_structure/blob/fc62e41/config.json)    - [document_folder_structure.py](#document_folder_structurepy) | [GitHub](https://github.com/sdkng44/document_folder_structure/blob/fc62e41/document_folder_structure.py)    - [requirements.txt](#requirementstxt) | [GitHub](https://github.com/sdkng44/document_folder_structure/blob/fc62e41/requirements.txt)
---
## DOCUMENTATION_EXAMPLES\all_files_content.md
<a name="DOCUMENTATION_EXAMPLESall_files_contentmd"></a>
_(Total lines: 867)_
_(Showing up to 10 lines, max 2000 characters)_
```markdown
1 | # Project File Contents
2 | 
3 | _Generated: 2025-07-22 01:05:29_
4 | 
5 | **Existing branches:** main
6 | **Current branch:** `main`
7 | **Commit:** `2caf255`
8 | **Repo:** https://github.com/sdkng44/document_folder_structure
9 | **Status:** ✔️ synced
10 | ## Index
```
---
## DOCUMENTATION_EXAMPLES\all_files_content.pdf
<a name="DOCUMENTATION_EXAMPLESall_files_contentpdf"></a>
_(Binary file omitted)_
```
```
---
## DOCUMENTATION_EXAMPLES\all_files_content.png
<a name="DOCUMENTATION_EXAMPLESall_files_contentpng"></a>
_(Binary file omitted)_
```
```
---
## DOCUMENTATION_EXAMPLES\directory_tree.md
<a name="DOCUMENTATION_EXAMPLESdirectory_treemd"></a>
_(Binary file omitted)_
```markdown
```
---
## DOCUMENTATION_EXAMPLES\directory_tree.pdf
<a name="DOCUMENTATION_EXAMPLESdirectory_treepdf"></a>
_(Binary file omitted)_
```
```
---
## DOCUMENTATION_EXAMPLES\directory_tree.png
<a name="DOCUMENTATION_EXAMPLESdirectory_treepng"></a>
_(Binary file omitted)_
```
```
---
## docs\document_folder_structure.html
<a name="docsdocument_folder_structurehtml"></a>
_(Total lines: 2035)_
_(Showing up to 10 lines, max 2000 characters)_
```html
1 | <!doctype html>
2 | <html lang="en">
3 | <head>
4 |     <meta charset="utf-8">
5 |     <meta name="viewport" content="width=device-width, initial-scale=1">
6 |     <meta name="generator" content="pdoc 15.0.4"/>
7 |     <title>document_folder_structure API documentation</title>
8 | 
9 |     <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ... [TRUNCATED]
```
---
## docs\index.html
<a name="docsindexhtml"></a>
_(Total lines: 7)_
_(Showing up to 10 lines, max 2000 characters)_
```html
1 | <!doctype html>
2 | <html>
3 | <head>
4 |     <meta charset="utf-8">
5 |     <meta http-equiv="refresh" content="0; url=./document_folder_structure.html"/>
6 | </head>
7 | </html>
```
---
## docs\search.js
<a name="docssearchjs"></a>
_(Total lines: 46)_
_(Showing up to 10 lines, max 2000 characters)_
```javascript
1 | window.pdocSearch = (function(){
2 | /** elasticlunr - http://weixsong.github.io * Copyright (C) 2017 Oliver Nightingale * Copyright (C) 2017 Wei Song * MIT Licensed */!function(){function e(e){if(null===e||"object"!=typeof e)return e;var t=e.constructor();for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}var t=function(e){var n=new t.Index;return n.pipeline.add(t.trimmer,t.stopWordFilter,t.stemmer),e&&e.call(n,n),n};t.version="0.9.5",lunr=t,t.utils={},t.utils.warn=function(e){return function(t){e.console&&console.warn&&console.warn(t)}}(this),t.utils.toString=function(e){return void 0===e||null===e?"":e.toString()},t.EventEmitter=function(){this.events={}},t.EventEmitter.prototype.addListener=function(){var e=Array.prototype.slice.call(arguments),t=e.pop(),n=e;if("function"!=typeof t)throw new TypeError("last argument must be a function");n.forEach(function(e){this.hasHandler(e)||(this.events[e]=[]),this.events[e].push(t)},this)},t.EventEmitter.prototype.removeListener=function(e,t){if(this.hasHandler(e)){var n=this.events[e].indexOf(t);-1!==n&&(this.events[e].splice(n,1),0==this.events[e].length&&delete this.events[e])}},t.EventEmitter.prototype.emit=function(e){if(this.hasHandler(e)){var t=Array.prototype.slice.call(arguments,1);this.events[e].forEach(function(e){e.apply(void 0,t)},this)}},t.EventEmitter.prototype.hasHandler=function(e){return e in this.events},t.tokenizer=function(e){if(!arguments.length||null===e||void 0===e)return[];if(Array.isArray(e)){var n=e.filter(function(e){return null===e||void 0===e?!1:!0});n=n.map(function(e){return t.utils.toString(e).toLowerCase()});var i=[];return n.forEach(function(e){var n=e.split(t.tokenizer.seperator);i=i.concat(n)},this),i}return e.toString().trim().toLowerCase().split(t.tokenizer.seperator)},t.tokenizer.defaultSeperator=/[\s\-]+/,t.tokenizer.seperator=t.tokenizer.defaultSeperator,t.tokenizer.setSeperator=function(e){null!==e&&void 0!==e&&"object"==typeof e&&(t.tokenizer.seperator=e)},t.tokenizer.resetSeper ... [TRUNCATED]
```
---
## LICENSE
<a name="LICENSE"></a>
_(Total lines: 201)_
_(Showing up to 10 lines, max 2000 characters)_
```
1 |                                  Apache License
2 |                            Version 2.0, January 2004
3 |                         http://www.apache.org/licenses/
4 | 
5 |    TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION
6 | 
7 |    1. Definitions.
8 | 
9 |       "License" shall mean the terms and conditions for use, reproduction,
10 |       and distribution as defined by Sections 1 through 9 of this document.
```
---
## README.md
<a name="READMEmd"></a>
_(Total lines: 145)_
_(Showing up to 10 lines, max 2000 characters)_
```markdown
1 | # document_folder_structure
2 | ## **Automatic Markdown Documentation and Directory Tree Generator**
3 | 
4 | This script generates structured Markdown documentation for any project directory, including:
5 | 
6 | - **directory_tree.md:** Directory structure with Git metadata (branch, commit, repo, etc.)
7 | - **all_files_content.md:** Grouped file index and content previews (with truncation for large files, CSV/Excel previews, and special handling for binaries and logs)
8 | - Skips configured folders/files (see configuration)
9 | - Automatically adds the documentation folder to `.gitignore`
10 | - Supports GitHub/GitLab links to each file at current commit (if Git is configured)
```
---
## config.json
<a name="configjson"></a>
_(Total lines: 14)_
```json
1 | {
2 |     "excluded_dirs": ["node_modules", "__pycache__", ".git", "deps", ".fingerprint", "build", "incremental"],
3 |     "excluded_files": [".gitignore", ".849C9593-D756-4E56-8D6E-42412F2A707B"],
4 |     "excluded_extensions": [".log", ".tmp", ".bak", ".db-shm", ".db-wal", ".npmrc", ".prettierignore", ".prettierrc"],
5 |     "max_depth": 4,
6 |     "truncate_files": ["README", "LICENSE", "CHANGELOG", "CONTRIBUTING", "SECURITY"],
7 |     "truncate_exts": [".md", ".txt"],
8 |     "truncate_dirs": ["docs"],
9 |     "truncate_file_pairs": [["document_folder_structure", ".html"]],
10 |     "max_truncate_chars": 2000,
11 |     "truncate_lines": 10,
12 |     "max_log_lines": 10,
13 | 	"max_preview_columns": 20
14 | }
```
---
## document_folder_structure.py
<a name="document_folder_structurepy"></a>
_(Total lines: 748)_
```python
1 | """
2 | Markdown Documentation and Directory Tree Generator for Projects.
3 | 
4 | Usage example:
5 |     python document_folder_structure.py C:\\path\\to\\your\\project
6 | 
7 | Creates two files in ./INTERNAL_DOCS/:
8 |     - directory_tree.md (directory structure with Git info)
9 |     - all_files_content.md (index and file contents, binaries omitted)
10 | 
11 | Includes Git metadata (branch, commit, branches, repo) and GitHub links (if applicable).
12 | Skips configurable folders/files (README, LICENSE, CHANGELOG, CONTRIBUTING, SECURITY).
13 | Automatically adds created folder to .gitignore.
14 | 
15 | Sample config file, first 4 lines are for exclude files and directories before the tree generation, 5-11 lines are for truncate file content on Markdown documentation:
16 | {
17 |     "excluded_dirs": ["node_modules", "__pycache__", ".git", "deps", ".fingerprint", "build", "incremental"],
18 |     "excluded_files": [".gitignore", ".849C9593-D756-4E56-8D6E-42412F2A707B"],
19 |     "excluded_extensions": [".log", ".tmp", ".bak", ".db-shm", ".db-wal", ".npmrc", ".prettierignore", ".prettierrc"],
20 |     "max_depth": 4,
21 |     "truncate_files": ["README", "LICENSE", "CHANGELOG", "CONTRIBUTING", "SECURITY"],
22 |     "truncate_exts": [".md", ".txt"],
23 |     "truncate_dirs": ["docs"],
24 |     "truncate_file_pairs": [["document_folder_structure", ".html"]],
25 |     "max_truncate_chars": 2000,
26 |     "truncate_lines": 10,
27 |     "max_log_lines": 10,
28 |     "max_preview_columns": 20
29 | }
30 | 
31 | Requirements:
32 |     - Python 3.6+
33 |     - Run "pip install -r requirements.txt" to install dependencies.
34 | 
35 | """
36 | import csv
37 | try:
38 |     import openpyxl
39 | except ImportError:
40 |     openpyxl = None
41 | import os
42 | import json
43 | import logging
44 | import datetime
45 | import subprocess
46 | from argparse import ArgumentParser
47 | 
48 | DEFAULTS = {
49 |     "excluded_dirs": ["node_modules", "__pycache__", ".git", "deps", ".fingerprint", "build", "incremental"],
50 |     "excluded_files": [".gitignore", ".849C9593-D756-4E56-8D6E-42412F2A707B"],
51 |     "excluded_extensions": [".log", ".tmp", ".bak", ".db-shm", ".db-wal", ".npmrc", ".prettierignore", ".prettierrc"],
52 |     "max_depth": 4,
53 |     "truncate_files": ["README", "LICENSE", "CHANGELOG", "CONTRIBUTING", "SECURITY"],
54 |     "truncate_exts": [".md", ".txt"],
55 |     "truncate_dirs": ["docs"],
56 |     "truncate_file_pairs": [["document_folder_structure", ".html"]],
57 |     "max_truncate_chars": 2000,
58 |     "truncate_lines": 10,
59 |     "max_log_lines": 10,
60 |     "max_preview_columns": 20
61 | }
62 | 
63 | # === SETUP LOGGING ===
64 | logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')
65 | 
66 | def add_line_numbers(lines, start=1):
67 |     """
68 |     Adds line numbers to each line in a list.
69 |     """
70 |     return [f"{i + start} | {line.rstrip()}\n" for i, line in enumerate(lines)]
71 | 
72 | 
73 | def load_config_with_defaults(config_file, args):
74 |     """
75 |     Load config file.
76 |     """
77 |     config = DEFAULTS.copy()
78 |     # Load config file
79 |     if os.path.exists(config_file):
80 |         with open(config_file, 'r') as f:
81 |             file_config = json.load(f)
82 |         config.update(file_config)
83 |     # Load args
84 |     if getattr(args, "max_depth", None) is not None:
85 |         config["max_depth"] = args.max_depth
86 |     if getattr(args, "truncate_lines", None) is not None:
87 |         config["truncate_lines"] = args.truncate_lines
88 |     if getattr(args, "truncate_chars", None) is not None:
89 |         config["max_truncate_chars"] = args.truncate_chars
90 |     if getattr(args, "max_log_lines", None) is not None:
91 |         config["max_log_lines"] = args.max_log_lines
92 |     if getattr(args, "max_preview_columns", None) is not None:
93 |         config["max_preview_columns"] = args.max_preview_columns
94 |     return config
95 | 
96 | 
97 | def read_n_lines_max_chars(filepath, config, max_lines=None, max_chars=None):
98 |     """
99 |     Reads up to `max_lines` lines and never more than `max_chars` characters.
100 |     Returns a list of lines (not joined), possibly truncated.
101 |     """
102 | 
103 |     if max_lines is None:
104 |         max_lines = config["truncate_lines"]
105 |     if max_chars is None:
106 |         max_chars = config["max_truncate_chars"]
107 | 
108 |     lines = []
109 |     char_count = 0
110 |     try:
111 |         with open(filepath, 'r', encoding='utf-8', errors='replace') as fin:
112 |             for i, line in enumerate(fin):
113 |                 if i >= max_lines or char_count >= max_chars:
114 |                     break
115 |                 # Only add up to remaining allowed characters for this line
116 |                 remaining = max_chars - char_count
117 |                 if len(line) > remaining:
118 |                     lines.append(line[:remaining] + " ... [TRUNCATED]\n")
119 |                     char_count += remaining
120 |                     break
121 |                 else:
122 |                     lines.append(line)
123 |                     char_count += len(line)
124 |     except Exception as e:
125 |         lines = [f"(Could not read file: {e})\n"]
126 |     return lines
127 | 
128 | 
129 | 
130 | def preview_csv(filepath, config, max_lines=None):
131 |     """
132 |     Returns the first lines of a CSV as a Markdown table.
133 |     """
134 | 
135 |     if max_lines is None:
136 |         max_lines = config["max_log_lines"]
137 |     max_columns = config["max_preview_columns"]
138 |     lines = []
139 |     try:
140 |         with open(filepath, newline='', encoding='utf-8', errors='replace') as csvfile:
141 |             reader = csv.reader(csvfile)
142 |             headers = next(reader, None)
143 |             if headers:
144 |                 if len(headers) > max_columns:
145 |                     lines.append(f"_(Only showing first {max_columns} columns)_")
146 |                 headers = headers[:max_columns]
147 |                 lines.append("| " + " | ".join(headers) + " |")
148 |                 lines.append("|" + "|".join("---" for _ in headers) + "|")
149 |             count = 0
150 |             for row in reader:
151 |                 row = row[:max_columns]
152 |                 lines.append("| " + " | ".join(row) + " |")
153 |                 count += 1
154 |                 if count >= max_lines:
155 |                     break
156 |     except Exception as e:
157 |         lines = [f"(Could not read CSV: {e})"]
158 |     return lines
159 | 
160 | def preview_excel(filepath, config, max_lines=None):
161 |     """
162 |     Returns the first lines of each sheet in an Excel (.xlsx) file as a Markdown table.
163 |     """
164 |     max_columns = config["max_preview_columns"]
165 |     if max_lines is None:
166 |         max_lines = config["max_log_lines"]
167 | 
168 | 
169 |     if openpyxl is None:
170 |         return ["(openpyxl is not installed, cannot preview Excel)"]
171 |     lines = []
172 |     try:
173 |         wb = openpyxl.load_workbook(filepath, read_only=True)
174 |         for sheet in wb.sheetnames:
175 |             ws = wb[sheet]
176 |             rows = list(ws.iter_rows(values_only=True))
177 |             if not rows:
178 |                 continue
179 |             lines.append(f"### Sheet: {sheet}")
180 |             headers = [str(h) if h is not None else "" for h in rows[0][:max_columns]]
181 |             if len(rows[0]) > max_columns:
182 |                 lines.append(f"_(Only showing first {max_columns} columns)_")
183 |             lines.append("| " + " | ".join(headers) + " |")
184 |             lines.append("|" + "|".join("---" for _ in headers) + "|")
185 |             for i, row in enumerate(rows[1:max_lines+1]):
186 |                 cells = [str(cell) if cell is not None else "" for cell in row[:max_columns]]
187 |                 lines.append("| " + " | ".join(cells) + " |")
188 |             lines.append("")
189 |     except Exception as e:
190 |         lines = [f"(Could not read Excel: {e})"]
191 |     return lines
192 | 
193 | 
194 | def ensure_gitignore_has_internal_docs(project_dir):
195 |     """
196 |     Ensures that the INTERNAL_DOCS/ folder is included in the .gitignore file.
197 | 
198 |     If .gitignore does not exist, it is created. If it exists but the line is missing, it is added.
199 | 
200 |     Args:
201 |         project_dir (str): Path to the project root directory.
202 |     """
203 |     gitignore_path = os.path.join(project_dir, '.gitignore')
204 |     try:
205 |         if not os.path.exists(gitignore_path):
206 |             with open(gitignore_path, 'w', encoding='utf-8') as f:
207 |                 f.write('INTERNAL_DOCS/\n')
208 |             return
209 |         with open(gitignore_path, 'r', encoding='utf-8') as f:
210 |             lines = f.read().splitlines()
211 |         if 'INTERNAL_DOCS/' not in lines:
212 |             with open(gitignore_path, 'a', encoding='utf-8') as f:
213 |                 with open(gitignore_path, 'rb') as fr:
214 |                     fr.seek(-1, os.SEEK_END)
215 |                     last_char = fr.read(1)
216 |                 if last_char != b'\n':
217 |                     f.write('\n')
218 |                 f.write('INTERNAL_DOCS/\n')
219 |     except Exception as e:
220 |         print(f"Warning: could not update .gitignore: {e}")
221 | 
222 | 
223 | 
224 | def ensure_internal_docs_dir(base_path):
225 |     """
226 |     Creates the INTERNAL_DOCS folder if it does not exist.
227 | 
228 |     Args:
229 |         base_path (str): Base path to create the folder in.
230 | 
231 |     Returns:
232 |         str: Absolute path to the INTERNAL_DOCS folder.
233 |     """
234 |     internal_docs = os.path.join(base_path, "INTERNAL_DOCS")
235 |     if not os.path.exists(internal_docs):
236 |         os.makedirs(internal_docs)
237 |     return internal_docs
238 | 
239 | def count_tree_stats(directory, config, max_depth=None, depth=0):
240 |     """
241 |     Counts the total files and folders in the tree, respecting exclusions and depth.
242 | 
243 |     Args:
244 |         directory (str): Path to the root directory.
245 |         config (dict): Configuration (exclusions).
246 |         max_depth (int, optional): Maximum depth to traverse.
247 |         depth (int, optional): Current depth.
248 | 
249 |     Returns:
250 |         (int, int): Tuple (files, folders)
251 |     """
252 |     total_files, total_dirs = 0, 0
253 |     try:
254 |         files = os.listdir(directory)
255 |     except Exception:
256 |         return 0, 0
257 |     for file in files:
258 |         path = os.path.join(directory, file)
259 |         if os.path.isdir(path):
260 |             if file not in config['excluded_dirs']:
261 |                 total_dirs += 1
262 |                 if max_depth is None or depth < max_depth:
263 |                     f, d = count_tree_stats(path, config, max_depth, depth + 1)
264 |                     total_files += f
265 |                     total_dirs += d
266 |         else:
267 |             if file in config['excluded_files'] or file.endswith(tuple(config['excluded_extensions'])):
268 |                 continue
269 |             total_files += 1
270 |     return total_files, total_dirs
271 | 
272 | def is_binary(filename, blocksize=512):
273 |     """
274 |     Heuristically detects if a file is binary.
275 | 
276 |     Args:
277 |         filename (str): File path.
278 | 
279 |     Returns:
280 |         bool: True if the file appears to be binary.
281 |     """
282 |     try:
283 |         with open(filename, 'rb') as f:
284 |             chunk = f.read(blocksize)
285 |             if b'\0' in chunk:
286 |                 return True
287 |             try:
288 |                 chunk.decode('utf-8')
289 |                 return False
290 |             except UnicodeDecodeError:
291 |                 return True
292 |     except Exception:
293 |         return True
294 |     return False
295 | 
296 | def get_github_url(git_info, filepath):
297 |     """
298 |     Builds a GitHub (or GitLab) URL for a given file and commit.
299 | 
300 |     Args:
301 |         git_info (tuple): (branch, commit, status, remote_url)
302 |         filepath (str): Relative file path.
303 | 
304 |     Returns:
305 |         str: GitHub URL (or empty if not applicable).
306 |     """
307 |     if not git_info or not git_info[3] or not git_info[1]:
308 |         return ""
309 |     remote = git_info[3]
310 |     commit = git_info[1]
311 |     # Supports SSH and HTTPS formats (GitHub and GitLab)
312 |     if remote.startswith("git@"):
313 |         remote = remote.replace(":", "/").replace("git@", "https://").replace(".git", "")
314 |     elif remote.startswith("https://"):
315 |         remote = remote.replace(".git", "")
316 |     return f"{remote}/blob/{commit}/{filepath.replace(os.sep, '/')}"
317 | 
318 | def get_git_info(directory):
319 |     """
320 |     Gets Git information for the repository in the given directory.
321 | 
322 |     Args:
323 |         directory (str): Path to the repo root directory.
324 | 
325 |     Returns:
326 |         tuple: (branch, commit, status, remote_url), or (None, None, None, None) if not a repo.
327 |     """
328 |     try:
329 |         branch = subprocess.check_output(
330 |             ["git", "rev-parse", "--abbrev-ref", "HEAD"],
331 |             cwd=directory, stderr=subprocess.DEVNULL
332 |         ).decode().strip()
333 |         commit = subprocess.check_output(
334 |             ["git", "rev-parse", "--short", "HEAD"],
335 |             cwd=directory, stderr=subprocess.DEVNULL
336 |         ).decode().strip()
337 |         status = subprocess.check_output(
338 |             ["git", "status", "--porcelain"],
339 |             cwd=directory, stderr=subprocess.DEVNULL
340 |         ).decode()
341 |         dirty = "✔️ synced" if not status else "⚠️ local changes (need to push to branch)"
342 |         remote = subprocess.check_output(
343 |             ["git", "config", "--get", "remote.origin.url"],
344 |             cwd=directory, stderr=subprocess.DEVNULL
345 |         ).decode().strip()
346 |         return branch, commit, dirty, remote
347 |     except Exception:
348 |         return None, None, None, None
349 | 
350 | def get_git_branches(directory):
351 |     """
352 |     Returns a list of existing branches in the repo.
353 | 
354 |     Args:
355 |         directory (str): Repo path.
356 | 
357 |     Returns:
358 |         list: List of branch names, empty if not a repo.
359 |     """
360 |     try:
361 |         out = subprocess.check_output(
362 |             ["git", "branch", "--format", "%(refname:short)"], cwd=directory
363 |         ).decode().strip().split("\n")
364 |         out = [x.strip() for x in out if x.strip()]
365 |         return out
366 |     except Exception:
367 |         return []
368 | 
369 | # Extension dictionary for code highlighting in Markdown code blocks
370 | LANG_EXT = {
371 |     ".py": "python", ".md": "markdown", ".json": "json", ".js": "javascript",
372 |     ".ts": "typescript", ".tsx": "tsx", ".jsx": "jsx", ".html": "html", ".css": "css",
373 |     ".scss": "scss", ".sass": "sass", ".less": "less", ".yml": "yaml", ".yaml": "yaml",
374 |     ".toml": "toml", ".sh": "bash", ".bat": "bat", ".ps1": "powershell", ".txt": "",
375 |     ".xml": "xml", ".csv": "csv", ".ini": "ini", ".conf": "conf", ".php": "php", ".rb": "ruby",
376 |     ".go": "go", ".java": "java", ".c": "c", ".cpp": "cpp", ".h": "cpp", ".hpp": "cpp", ".rs": "rust",
377 |     ".env": "", ".sql": "sql", ".log": ""
378 | }
379 | """
380 |     Dictionary of possible file extensions for Markdown code highlighting.
381 | """
382 | 
383 | # Always exclude generated documentation files
384 | DOC_OUTPUTS = {"directory_tree.md", "all_files_content.md"}
385 | 
386 | def generate_tree_and_collect_files(
387 |     directory, prefix="", depth=0, max_depth=None, is_last=True, config=None,
388 |     files_list=None, extensions_set=None, exclude_outputs=True, base_docs_path=None
389 | ):
390 |     """
391 |     Generates the directory tree (as text) and collects the list of valid files.
392 | 
393 |     Args:
394 |         directory (str): Project root.
395 |         prefix (str): Visual prefix for branches.
396 |         depth (int): Current depth.
397 |         max_depth (int): Maximum depth to traverse.
398 |         is_last (bool): Whether this is the last item at this level.
399 |         config (dict): Exclusion configuration.
400 |         files_list (list): List to add found files to.
401 |         extensions_set (set): Set of detected extensions.
402 |         exclude_outputs (bool): Whether to exclude generated docs.
403 |         base_docs_path (str): Base path for relative paths.
404 | 
405 |     Returns:
406 |         list: Lines of the tree.
407 |     """
408 |     if max_depth is not None and depth > max_depth:
409 |         return []
410 |     try:
411 |         files = os.listdir(directory)
412 |     except PermissionError as e:
413 |         logging.warning(f"Permission denied: {e}")
414 |         return []
415 |     files.sort()
416 |     tree = []
417 |     excluded_dirs = config['excluded_dirs']
418 |     excluded_files = set(config['excluded_files'])
419 |     excluded_extensions = tuple(config['excluded_extensions'])
420 |     for index, file in enumerate(files):
421 |         path = os.path.join(directory, file)
422 |         is_last_item = index == len(files) - 1
423 |         connector = "└── " if is_last_item else "├── "
424 |         if os.path.isdir(path):
425 |             if file in excluded_dirs:
426 |                 tree.append(f"{prefix}{connector}+ {file}/ (excluded)")
427 |             else:
428 |                 tree.append(f"{prefix}{connector}+ {file}/")
429 |                 tree.extend(
430 |                     generate_tree_and_collect_files(
431 |                         path, prefix + ("    " if is_last_item else "│   "),
432 |                         depth + 1, max_depth, is_last_item, config, files_list, extensions_set, exclude_outputs, base_docs_path
433 |                     )
434 |                 )
435 |         else:
436 |             rel_file = os.path.relpath(path, base_docs_path)
437 |             if (
438 |                 file in excluded_files or
439 |                 file.endswith(excluded_extensions) or
440 |                 (exclude_outputs and file in DOC_OUTPUTS and os.path.dirname(path).endswith("INTERNAL_DOCS"))
441 |             ):
442 |                 continue
443 |             tree.append(f"{prefix}{connector}- {file}")
444 |             if files_list is not None:
445 |                 files_list.append(os.path.relpath(path, base_docs_path))
446 |             if extensions_set is not None:
447 |                 ext = os.path.splitext(file)[1].lower()
448 |                 extensions_set.add(ext)
449 |     return tree
450 | 
451 | def markdown_tree_header(title, total_files, total_dirs, git_info=None, extensions=None, branches=None):
452 |     """
453 |     Builds the header for the directory tree, with git metadata and extensions.
454 | 
455 |     Args:
456 |         title (str): Title.
457 |         total_files (int): Number of files.
458 |         total_dirs (int): Number of folders.
459 |         git_info (tuple): Git info.
460 |         extensions (set): Detected extensions.
461 |         branches (list): Repo branches.
462 | 
463 |     Returns:
464 |         str: Markdown header.
465 |     """
466 |     now = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
467 |     header = f"# {title}\n\n_Generated: {now}_\n\n"
468 |     if branches:
469 |         header += f"**Existing branches:** {', '.join(branches)}  \n"
470 |     if git_info and git_info[0]:
471 |         header += (
472 |             f"**Current branch:** `{git_info[0]}`  \n"
473 |             f"**Commit:** `{git_info[1]}`  \n"
474 |             f"**Repo:** {git_info[3]}  \n"
475 |             f"**Status:** {git_info[2]}\n\n"
476 |         )
477 |     if extensions:
478 |         exts = ", ".join(sorted(ext for ext in extensions if ext))
479 |         header += f"**Detected extensions:** `{exts}`\n\n" if exts else ""
480 |     header += f"_(Files: {total_files}, Folders: {total_dirs})_\n\n```text\n"
481 |     return header
482 | 
483 | def markdown_tree_footer():
484 |     """Returns the footer for the tree block (code block closing)."""
485 |     return "```\n"
486 | 
487 | def print_tree_and_collect_files(
488 |     directory, config, output_file="directory_tree.md", tree_title="Project Directory Tree"
489 | ):
490 |     """
491 |     Prints the tree in Markdown and returns the list of found files and git_info.
492 | 
493 |     Returns:
494 |         files_list (list): Found files.
495 |         git_info (tuple): Git info of the repo.
496 |     """
497 |     max_depth = config.get('max_depth')
498 |     files_list = []
499 |     extensions_set = set()
500 |     tree = generate_tree_and_collect_files(
501 |         directory, max_depth=max_depth, config=config,
502 |         files_list=files_list, extensions_set=extensions_set,
503 |         exclude_outputs=True, base_docs_path=directory
504 |     )
505 |     total_files, total_dirs = count_tree_stats(directory, config, max_depth)
506 |     git_info = get_git_info(directory)
507 |     git_branches = get_git_branches(directory)
508 |     header = markdown_tree_header(tree_title, total_files, total_dirs, git_info, extensions_set, git_branches)
509 |     footer = markdown_tree_footer()
510 |     with open(output_file, 'w', encoding='utf-8') as f:
511 |         f.write(header)
512 |         for line in tree:
513 |             f.write(line + "\n")
514 |         f.write(footer)
515 |     return files_list, git_info
516 | 
517 | def group_files_by_folder(files_list):
518 |     """
519 |     Converts a list of files into a hierarchical tree (nested dicts) by folder.
520 |     """
521 |     tree = {}
522 |     for path in files_list:
523 |         parts = path.split(os.sep)
524 |         cur = tree
525 |         for i, part in enumerate(parts):
526 |             if i == len(parts) - 1:
527 |                 cur.setdefault("_files", []).append(path)
528 |             else:
529 |                 cur = cur.setdefault(part, {})
530 |     return tree
531 | 
532 | def render_index(tree, basepath="", git_info=None, level=0):
533 |     """
534 |     Renders the grouped index in Markdown from the folder/file tree.
535 | 
536 |     Args:
537 |         tree (dict): Tree generated by group_files_by_folder.
538 |         basepath (str): Current base path.
539 |         git_info (tuple): Git info for links.
540 |         level (int): Indentation.
541 | 
542 |     Returns:
543 |         list: Markdown lines.
544 |     """
545 |     lines = []
546 |     indent = "    " * level
547 |     folders = [k for k in tree if k != "_files"]
548 |     for folder in folders:
549 |         lines.append(f"{indent}- **{folder}/**")
550 |         lines.extend(render_index(tree[folder], os.path.join(basepath, folder), git_info, level+1))
551 |     if "_files" in tree:
552 |         for filepath in tree["_files"]:
553 |             anchor = filepath.replace("/", "").replace(".", "").replace("\\", "")
554 |             url = get_github_url(git_info, filepath)
555 |             fname = os.path.basename(filepath)
556 |             link_line = f"{indent}    - [{fname}](#{anchor})"
557 |             if url:
558 |                 link_line += f" | [GitHub]({url})"
559 |             lines.append(link_line)
560 |     return lines
561 | 
562 | 
563 | 
564 | 
565 | def should_truncate_file(filepath, config):
566 |     """
567 |     Determines if a file should be truncated in preview, by name/extension/path.
568 |     """
569 | 
570 |     for d in config["truncate_dirs"]:
571 |         parts = [p.lower() for p in filepath.replace("\\", "/").split("/")]
572 |         if d.lower() in parts:
573 |             return True
574 | 
575 |     base = os.path.splitext(os.path.basename(filepath))[0]
576 |     ext = os.path.splitext(filepath)[1].lower()
577 |     for pair in config["truncate_file_pairs"]:
578 |         if base == pair[0] and ext == pair[1]:
579 |             return True
580 | 
581 |     if base.upper() in (t.upper() for t in config["truncate_files"]):
582 |         return True
583 | 
584 |     if ext in config["truncate_exts"]:
585 |         return True
586 | 
587 |     return False
588 | 
589 | 
590 | 
591 | def flatten_files_in_tree(tree):
592 |     """
593 |     Returns an ordered list of all files in the hierarchical tree.
594 |     """
595 |     files = []
596 |     folders = [k for k in tree if k != "_files"]
597 |     for folder in folders:
598 |         files.extend(flatten_files_in_tree(tree[folder]))
599 |     if "_files" in tree:
600 |         files.extend(tree["_files"])
601 |     return files
602 | 
603 | def generate_content_document(
604 |     files_list, output_file, git_info, config, base_docs_path=None, project_dir=None, no_lines=False
605 | ):
606 |     """
607 |     Generates the content document with index and preview/truncation of each file.
608 | 
609 |     Args:
610 |         files_list (list): List of files.
611 |         output_file (str): Output file.
612 |         git_info (tuple): Git info.
613 |         config: Config.json file.
614 |         base_docs_path (str): Root for paths.
615 |         project_dir (str): For git branch info.
616 | 
617 |     Effect: writes the Markdown content file.
618 |     """
619 |     now = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
620 |     out_lines = [f"# Project File Contents\n\n_Generated: {now}_\n\n"]
621 |     branches = get_git_branches(project_dir)
622 |     if branches:
623 |         out_lines.append(f"**Existing branches:** {', '.join(branches)}  \n")
624 |     if git_info and git_info[0]:
625 |         out_lines.append(
626 |             f"**Current branch:** `{git_info[0]}`  \n"
627 |             f"**Commit:** `{git_info[1]}`   \n"
628 |             f"**Repo:** {git_info[3]}  \n"
629 |             f"**Status:** {git_info[2]} \n"
630 |         )
631 |     out_lines.append("## Index\n")
632 |     index_tree = group_files_by_folder(files_list)
633 |     out_lines.extend(render_index(index_tree, "", git_info, level=0))
634 |     out_lines.append("\n---\n")
635 |     ordered_files = flatten_files_in_tree(index_tree)
636 |     for file_path in ordered_files:
637 |         ext = os.path.splitext(file_path)[1].lower()
638 |         language = LANG_EXT.get(ext, "")
639 |         anchor = file_path.replace("/", "").replace(".", "").replace("\\", "")
640 |         out_lines.append(f"## {file_path}\n<a name=\"{anchor}\"></a>\n")
641 |         abs_path = file_path if not base_docs_path else os.path.join(base_docs_path, file_path)
642 |         if os.path.exists(abs_path) and not is_binary(abs_path):
643 |             try:
644 |                 with open(abs_path, 'r', encoding='utf-8', errors='replace') as f:
645 |                     total_lines = sum(1 for _ in f)
646 |                 out_lines.append(f"_(Total lines: {total_lines})_\n")
647 |             except Exception:
648 |                 pass
649 |         if is_binary(abs_path):
650 |             out_lines.append("_(Binary file omitted)_\n")
651 |             out_lines.append(f"```{language}\n```\n")
652 |         elif ext == ".csv":
653 |             out_lines.append("_(CSV preview)_\n")
654 |             out_lines.append(f"_(Showing first {config['max_log_lines']} rows)_\n")
655 |             out_lines.extend(preview_csv(abs_path, config))
656 |             out_lines.append("\n")
657 |         elif ext == ".xlsx":
658 |             out_lines.append("_(Excel preview)_\n")
659 |             out_lines.append(f"_(Showing first {config['max_log_lines']} rows)_\n")
660 |             out_lines.extend(preview_excel(abs_path, config))
661 |             out_lines.append("\n")
662 |         elif ext == ".xls":
663 |             out_lines.append("_(Preview not supported for .xls files. Use .xlsx)_\n")
664 |         elif ext == ".log":
665 |             try:
666 |                 with open(abs_path, 'r', encoding='utf-8', errors='replace') as fin:
667 |                     lines = fin.readlines()
668 |                 if len(lines) > config["max_log_lines"]:
669 |                     out_lines.append(f"_(Showing last {config['max_log_lines']} lines)_\n")
670 |                 numbered_lines = add_line_numbers(lines[-config["max_log_lines"]:], start=max(1, len(lines)-config["max_log_lines"]+1))
671 |                 out_lines.append(f"```{language}\n")
672 |                 out_lines.extend(numbered_lines)
673 |                 out_lines.append("```\n")
674 |             except Exception as e:
675 |                 logging.warning(f"Could not read {abs_path}: {e}")
676 |                 out_lines.append(f"(Could not read file: {e})\n")
677 |         elif should_truncate_file(abs_path, config):
678 |             try:
679 |                 lines = read_n_lines_max_chars(abs_path, config)
680 |                 if not no_lines:
681 |                     lines = add_line_numbers(lines)
682 |                 else:
683 |                     lines = [l if l.endswith('\n') else l + '\n' for l in lines]
684 |                 out_lines.append(f"_(Showing up to {config['truncate_lines']} lines, max {config['max_truncate_chars']} characters)_\n")
685 |                 out_lines.append(f"```{language}\n")
686 |                 out_lines.extend(lines)
687 |                 out_lines.append("```\n")
688 |             except Exception as e:
689 |                 logging.warning(f"Could not read {abs_path}: {e}")
690 |                 out_lines.append(f"(Could not read file: {e})\n")
691 |         else:
692 |             try:
693 |                 with open(abs_path, 'r', encoding='utf-8', errors='replace') as fin:
694 |                     lines = fin.readlines()
695 |                 if not no_lines:
696 |                     lines = add_line_numbers(lines)
697 |                 else:
698 |                     lines = [l if l.endswith('\n') else l + '\n' for l in lines]
699 |                 out_lines.append(f"```{language}\n")
700 |                 out_lines.extend(lines)
701 |                 out_lines.append("```\n")
702 |             except Exception as e:
703 |                 logging.warning(f"Could not read {abs_path}: {e}")
704 |                 out_lines.append(f"(Could not read file: {e})\n")
705 |         if not out_lines[-1].endswith('\n'):
706 |             out_lines.append('\n')
707 |         out_lines.append("---\n")
708 |     with open(output_file, 'w', encoding='utf-8') as out:
709 |         out.write("".join(out_lines))
710 | 
711 | 
712 | # ========== MAIN ==========
713 | if __name__ == "__main__":
714 |     parser = ArgumentParser(description="Generates directory tree and file content documentation in Markdown, with Git info, links, and special handling for binaries, logs, and truncated files.")
715 |     parser.add_argument("directory", help="Project root directory.")
716 |     parser.add_argument("--config", default="config.json", help="JSON configuration file.")
717 |     parser.add_argument("--max-depth", type=int, help="Maximum tree depth.")
718 |     parser.add_argument("--tree-title", default="Project Directory Tree", help="Title for the tree Markdown.")
719 |     parser.add_argument("--truncate-lines", type=int, help="Max lines for files like README, LICENSE, etc.")
720 |     parser.add_argument("--truncate-chars", type=int, help="Max characters to show for truncated files")
721 |     parser.add_argument("--max-log-lines", type=int, help="Max lines to show for .log files")
722 |     parser.add_argument("--max-preview-columns", type=int, help="Max columns to show in CSV/Excel preview")
723 |     parser.add_argument("--no-lines", action="store_true", help="Disable per-line numbering in file previews")
724 |     args = parser.parse_args()
725 | 
726 |     config = load_config_with_defaults(args.config, args)
727 | 
728 |     ensure_gitignore_has_internal_docs(args.directory)
729 |     output_dir = ensure_internal_docs_dir(args.directory)
730 |     tree_output_path = os.path.join(output_dir, "directory_tree.md")
731 |     content_output_path = os.path.join(output_dir, "all_files_content.md")
732 |     files_list, git_info = print_tree_and_collect_files(
733 |         args.directory,
734 |         config,
735 |         output_file=tree_output_path,
736 |         tree_title=args.tree_title
737 |     )
738 |     generate_content_document(
739 |         files_list,
740 |         output_file=content_output_path,
741 |         git_info=git_info,
742 |         config=config,
743 |         base_docs_path=args.directory,
744 |         project_dir=args.directory,
745 |         no_lines=args.no_lines
746 |     )
747 |     print(f"DONE -> Directory tree saved in {tree_output_path}")
748 |     print(f"DONE -> File contents saved in {content_output_path}")
```
---
## requirements.txt
<a name="requirementstxt"></a>
_(Total lines: 1)_
_(Showing up to 10 lines, max 2000 characters)_
```
1 | openpyxl>=3.0.0
```
---
